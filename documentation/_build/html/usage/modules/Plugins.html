



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Plugins &mdash; PyMoDAQ 1.1.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Utility Modules" href="Utility_Modules.html" />
    <link rel="prev" title="Saving datas" href="../saving.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> PyMoDAQ
          

          
            
            <img src="../../_static/splash.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Features.html">PyMoDAQ features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../How_to_start.html">How to Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Description.html">Description</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Main_Modules.html">Main Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_viewers.html">Data Viewers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../saving.html">Saving datas</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#naming-convention">Naming convention:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-settings">Hardware Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#daq-move-plugin-template">DAQ Move plugin template</a></li>
<li class="toctree-l3"><a class="reference internal" href="#daq-viewer-plugin-template">DAQ Viewer plugin template</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#emission-of-data">Emission of data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-ready">Data ready?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#synchronous-example">Synchronous example:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#asynchronous-example">Asynchronous example:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-averaging">Hardware averaging:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-needed-files">Hardware needed files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#specific-tcp-ip-plugin">Specific TCP/IP plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-contribute">How to contribute?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Utility_Modules.html">Utility Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../classDiagram.html">Class Diagram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../APIdoc.html">Library Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyMoDAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../Description.html">Description</a> &raquo;</li>
        
      <li>Plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/usage/modules/Plugins.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="plugins">
<span id="plugin-doc"></span><h1>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Any new hardware has to be included in PyMoDAQ as a python plugin. This is a script containing a python object following a particular template and behaviour and inheriting from a base class.
Plugins are articulated given their type: Moves or Viewers and for the last their main dimensionality: <strong>0D</strong>, <strong>1D</strong> or <strong>2D</strong>.
It is recommended to start from the <em>template</em> plugins (daq_move_Template, daq_NDviewer_Template, see below)
and then check from other examples (pymodaq_plugins <a class="reference external" href="https://github.com/CEMES-CNRS/pymodaq_plugins">repository</a>) the proper way of writing a plugin. You will find below some information on the <strong>how to</strong>
but comparison with existing ones will be beneficial.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>All plugins are located in the <strong>pymodaq_plugins</strong> repository on github. This constitutes a python package that will be
installed together with PyMoDAQ (or manually install it if you don’t want the up to date version). PyMoDAQ will therefore
call the plugins from the <em>pymodaq_plugins</em> package installed on the <em>site_packages</em> location in python distribution.</p>
</div>
<div class="section" id="naming-convention">
<h2>Naming convention:<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h2>
<p>For the plugin to be properly recognised by PyMoDAQ, its location and name must follow these rules:</p>
<ul class="simple">
<li>An actuator plugin (name: xxxx) will be a script whose name is daq_move_Xxxx (notice first X letter is capital)</li>
<li>The plugin class within the script will be named DAQ_Move_Xxxx (notice the capital letters here as well)</li>
<li>the script will be located within pymodaq_plugins installed package tree in <code class="docutils literal notranslate"><span class="pre">C:\WPy-3710\...\pymodaq_plugins\daq_move_plugins\</span></code></li>
<li>A detector plugin of dimensionality N (N=0, 1 or 2) (name: xxxx) will be a script whose name is daq_NDviewer_Xxxx (notice first X letter is capital, and replace N by 0, 1 or 2)</li>
<li>The plugin class within the script will be named DAQ_NDViewer_Xxxx (notice the capital letters here as well)</li>
<li>the script will be located within pymodaq_plugins installed package tree in <code class="docutils literal notranslate"><span class="pre">C:\WPy-3710\...\pymodaq_plugins\daq_viewer_plugins\plugins_ND</span></code> (replace N by 0, 1 or 2)</li>
</ul>
</div>
<div class="section" id="hardware-settings">
<span id="id2"></span><h2>Hardware Settings<a class="headerlink" href="#hardware-settings" title="Permalink to this headline">¶</a></h2>
<p>An important feature similar for all modules is the layout as a tree structure of all the hardware parameters.
These settings will appear on the UI as a tree of parameters with a title and different types, see <a class="reference internal" href="#figure-settings"><span class="std std-numref">Fig. 23</span></a>.
On the module side, they will be instantiated as a list of dictionaries and later exist in the object <code class="docutils literal notranslate"><span class="pre">self.settings</span></code>.
This object inherits from on the <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> object defined in <a class="reference external" href="http://www.pyqtgraph.org/documentation/parametertree/index.html">pyqtgraph</a>.</p>
<blockquote>
<div></div></blockquote>
<div class="figure" id="id9">
<span id="figure-settings"></span><img alt="Settings example" src="../../_images/settings_example.png" />
<p class="caption"><span class="caption-number">Fig. 23 </span><span class="caption-text">Typical hardware settings represented as a tree structure (here from the <code class="docutils literal notranslate"><span class="pre">daq_2Dviewer_AndorCCD</span></code> plugin)</span></p>
</div>
<p>Here is an example of such a list of dictionaries corresponding to <a class="reference internal" href="#figure-settings"><span class="std std-numref">Fig. 23</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Dll library:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;andor_lib&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;browsepath&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">libpath</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Camera Settings:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;camera_settings&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;expanded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Camera SN:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;camera_serialnumber&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;readonly&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
     <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Camera Model:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;camera_model&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;readonly&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
     <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Readout Modes:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;readout&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;FullVertBinning&#39;</span><span class="p">,</span><span class="s1">&#39;Imaging&#39;</span><span class="p">],</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;FullVertBinning&#39;</span><span class="p">},</span>
     <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Readout Settings:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;readout_settings&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">:[</span>
         <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;single Track Settings:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;st_settings&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">:[</span>
             <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Center pixel:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;st_center&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
             <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Height:&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;st_height&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
             <span class="p">]},]}]}]</span>
</pre></div>
</div>
<p>The list of available types of parameters <a href="#id4"><span class="problematic" id="id5">:module:`custom_parameter_tree`</span></a> (defined in <code class="docutils literal notranslate"><span class="pre">pymodaq.daq_utils.custom_parameter_tree.py</span></code>) is:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">group</span></code> : “camera settings” on <a class="reference internal" href="#figure-settings"><span class="std std-numref">Fig. 23</span></a> is of type group</li>
<li><code class="docutils literal notranslate"><span class="pre">int</span></code> : settable integer (SpinBox_Custom object)</li>
<li><code class="docutils literal notranslate"><span class="pre">float</span></code> : settable float (SpinBox_Custom object)</li>
<li><code class="docutils literal notranslate"><span class="pre">str</span></code> : a QLineEdit object (see Qt5 documentation)</li>
<li><code class="docutils literal notranslate"><span class="pre">list</span></code> : “Readout Modes” <a class="reference internal" href="#figure-settings"><span class="std std-numref">Fig. 23</span></a> is a combo box</li>
<li><code class="docutils literal notranslate"><span class="pre">bool</span></code> : checkable boolean</li>
<li><code class="docutils literal notranslate"><span class="pre">led</span></code> : checkable boolean in the form of a green (True) of red (False) led</li>
<li><code class="docutils literal notranslate"><span class="pre">date_time</span></code> : a QDateTime object (see Qt5 documentation)</li>
<li><code class="docutils literal notranslate"><span class="pre">date</span></code> : a QDate object (see Qt5 documentation)</li>
<li><code class="docutils literal notranslate"><span class="pre">time</span></code> : a QTime object (see Qt5 documentation)</li>
<li><code class="docutils literal notranslate"><span class="pre">slide</span></code> : a combination of a slide and spinbox for floating point values</li>
<li><code class="docutils literal notranslate"><span class="pre">itemselect</span></code> : an object to easily select one or more items among a few</li>
<li><code class="docutils literal notranslate"><span class="pre">browsepath</span></code>: a text area and a pushbutton to select a given path or file</li>
<li><code class="docutils literal notranslate"><span class="pre">text</span></code> : a text area (for comments for instance)</li>
</ul>
<p>Once the module is initialized, any modification on the UI hardware settings will be send to the plugin through
the <code class="docutils literal notranslate"><span class="pre">commit_settings</span></code> method of the plugin class and illustrated below (still from the <code class="docutils literal notranslate"><span class="pre">daq_2Dviewer_AndorCCD</span></code> plugin).
The <code class="docutils literal notranslate"><span class="pre">param</span></code> method argument is of the type <code class="docutils literal notranslate"><span class="pre">Parameter</span></code> (from <code class="docutils literal notranslate"><span class="pre">pyqtgraph</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">commit_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        | Activate parameters changes on the hardware from parameter&#39;s name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;set_point&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">SetTemperature</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;readout&#39;</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="ow">in</span> <span class="n">custom_parameter_tree</span><span class="o">.</span><span class="n">iter_children</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="s1">&#39;camera_settings&#39;</span><span class="p">,</span> <span class="s1">&#39;readout_settings&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_read_mode</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;exposure&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">SetExposureTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="s1">&#39;camera_settings&#39;</span><span class="p">,</span><span class="s1">&#39;exposure&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">#temp should be in s</span>
            <span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">timings</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">GetAcquisitionTimings</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="s1">&#39;camera_settings&#39;</span><span class="p">,</span><span class="s1">&#39;exposure&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">timings</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;grating&#39;</span><span class="p">:</span>
            <span class="n">index_grating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grating_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_set_grating</span><span class="p">(</span><span class="n">index_grating</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit_status</span><span class="p">(</span><span class="n">ThreadCommand</span><span class="p">(</span><span class="s1">&#39;show_splash&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Setting wavelength&quot;</span><span class="p">]))</span>
            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">SetWavelengthSR</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="s1">&#39;spectro_settings&#39;</span><span class="p">,</span><span class="s1">&#39;spectro_wl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit_status</span><span class="p">(</span><span class="n">ThreadCommand</span><span class="p">(</span><span class="s1">&#39;close_splash&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="daq-move-plugin-template">
<h2>DAQ Move plugin template<a class="headerlink" href="#daq-move-plugin-template" title="Permalink to this headline">¶</a></h2>
<p>An actuator plugin is a python class inheriting from a base class. Let’s say you want to create the <em>template</em> plugin.
You will first create a <code class="docutils literal notranslate"><span class="pre">daq_move_Template.py</span></code> file in the <code class="docutils literal notranslate"><span class="pre">\pymodaq_plugins\daq_move_plugins</span></code> folder.
The plugin class will be called <code class="docutils literal notranslate"><span class="pre">DAQ_Move_Template</span></code>.</p>
<p>See <a class="reference download internal" download="" href="../../_downloads/3cbf2dd2cc46ee5a899781c3d129fe43/daq_move_Template.py"><code class="xref download docutils literal notranslate"><span class="pre">daq_move_Template.py</span></code></a> for a detailed template.</p>
</div>
<div class="section" id="daq-viewer-plugin-template">
<span id="viewer-plugins"></span><h2>DAQ Viewer plugin template<a class="headerlink" href="#daq-viewer-plugin-template" title="Permalink to this headline">¶</a></h2>
<p>A detector plugin is a python class inheriting from a base class. Let’s say you want to create the <em>template</em> plugin.
You will first create a <code class="docutils literal notranslate"><span class="pre">daq_NDviewer_Template.py</span></code> file in the <code class="docutils literal notranslate"><span class="pre">\pymodaq_plugins\daq_viewer_plugins\plugins_ND\</span></code>
folder (with N=0, 1 or 2 depending the data dimensionality of your detector).
The plugin class will be called <code class="docutils literal notranslate"><span class="pre">DAQ_NDViewer_Template</span></code>.</p>
<p>See <a class="reference download internal" download="" href="../../_downloads/889d5f246ff977002f43fe7fb2305bdb/daq_NDviewer_Template.py"><code class="xref download docutils literal notranslate"><span class="pre">daq_NDviewer_Template.py</span></code></a> for a detailed template.</p>
<div class="section" id="emission-of-data">
<span id="data-emission"></span><h3>Emission of data<a class="headerlink" href="#emission-of-data" title="Permalink to this headline">¶</a></h3>
<p>When data are ready (see <a class="reference internal" href="#data-ready"><span class="std std-ref">Data ready?</span></a> to know about that), the plugin has to notify the viewer module in order
to display data and eventually save them. For this PyMoDAQ use two types of signals (see pyqtsignal documentation for details):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">data_grabed_signal_temp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">data_grabed_signal</span></code></li>
</ul>
<p>They both <em>emit</em> the same type of signal but will trigger different behaviour from the viewer module. The first is to be
used to send temporary data to update the plotting but without triggering anything else (so that the DAQ_Scan still awaits
for data completion before moving on). It is also used in the initialisation of the plugin in order to preset the type and number of data viewers
displayed by the viewer module. The second signal is to be used once data are fully ready to be send back to the user interface
and further processed by DAQ_Scan or DAQ_Viewer instances. The code below is an example of emission of data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">vector_X</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">data_grabed_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Camera&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">data2D_0</span><span class="p">,</span> <span class="n">data2D_1</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Data2D&#39;</span><span class="p">,</span><span class="n">x_axis</span><span class="o">=</span><span class="n">vector_X</span><span class="p">,</span><span class="n">y_axis</span><span class="o">=</span><span class="n">vector_Y</span><span class="p">),</span>
                              <span class="n">OrderedDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">data1D_0</span><span class="p">,</span> <span class="n">data1D_1</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Data1D&#39;</span><span class="p">,</span><span class="n">x_axis</span><span class="o">=</span><span class="n">vector_X</span><span class="p">),</span>
                              <span class="n">OrderedDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Current&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">data0D_0</span><span class="p">,</span> <span class="n">data0D_1</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Data0D&#39;</span><span class="p">),</span>
                              <span class="n">OrderedDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Datacube&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">dataND_0</span><span class="p">,</span> <span class="n">dataND_1</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;DataND&#39;</span><span class="p">,</span> <span class="n">nav_axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span>
                                        <span class="p">])</span>
</pre></div>
</div>
<p>Such an emitted signal would trigger the initialization of 4 data viewers in the viewer module. One for each <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code>
in the emitted list. The type of data viewer will be determined by the <em>type</em> key value while its name will be set to the <em>name</em> key value.
The <em>data</em> key value is also a list of numpy arrays, their shape should be adequate with the <em>type</em> key of the dictionary.
Each array will generate one channel within the corresponding viewer. Here is the detailed list of the possible keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: will display the corresponding value on the viewer dock</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: will set the viewer type (0D, 1D, 2D or multi-dimensional ND). The ND viewer will be able to deal with data dimensionality up to 4)</li>
<li><code class="docutils literal notranslate"><span class="pre">data</span></code>: list of numpy array. Each array shape should correspond to the <em>type</em></li>
<li><code class="docutils literal notranslate"><span class="pre">x_axis</span></code>: either a numpy 1D array representing the x axis of the detector (wavelength for a spectrometer for instance,
default is pixel number) or a dictionnary containing various fields to set the axis labels, units on the viewer
(see code above)</li>
<li><code class="docutils literal notranslate"><span class="pre">y_axis</span></code>: either a numpy 1D array representing the y axis of the detector (only for 2D detector)
(default is pixel number) or a dictionnary containing various fields to set the axis labels, units on the viewer
(see code above)</li>
<li><code class="docutils literal notranslate"><span class="pre">nav_axis</span></code>: in case of a ND data viewer, will be the index of the navigation axis, see <a class="reference internal" href="data_viewers.html#ndviewer"><span class="std std-ref">ND Viewer</span></a></li>
</ul>
</div>
<div class="section" id="data-ready">
<span id="id6"></span><h3>Data ready?<a class="headerlink" href="#data-ready" title="Permalink to this headline">¶</a></h3>
<p>One difficulty with these viewer plugins is to determine when data is ready to be read from the controller and then
to be send to the user interface for plotting and saving. There are a few solutions:</p>
<ul class="simple">
<li><strong>synchronous</strong>: The simplest one. When the <code class="docutils literal notranslate"><span class="pre">grab</span></code> command has been send to the controller (let’s say to its <code class="docutils literal notranslate"><span class="pre">grab_sync</span></code> method), the <code class="docutils literal notranslate"><span class="pre">grab_sync</span></code> method will hold and freeze the plugin until the data are ready. The Mock or Tektronix modules work like this.</li>
<li><strong>asynchronous</strong>: There are 2 ways of doing asynchronous <em>waiting</em>. The first is to poll the controller state to check if data are
ready within a loop. This polling could be done with a while loop but if nothing more is done then the plugin will still be
freezed, except if one process periodically the Qt queue event using <code class="docutils literal notranslate"><span class="pre">QtWidgets.QApplication.processEvents()</span></code> method. The
polling can also be done with a timer event, firing periodically a check of the data state (ready or not). Finally, the
nicest/hardest solution is to use callbacks (if the controller provides one) and link it to a <code class="docutils literal notranslate"><span class="pre">emit_data</span></code> method.</li>
</ul>
</div>
<div class="section" id="synchronous-example">
<h3>Synchronous example:<a class="headerlink" href="#synchronous-example" title="Permalink to this headline">¶</a></h3>
<p>The code below illustrates the poll method using a loop:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">poll_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Poll the current data state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sleep_ms</span><span class="o">=</span><span class="mi">50</span>
    <span class="n">ind</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">data_ready</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
        <span class="n">QThread</span><span class="o">.</span><span class="n">msleep</span><span class="p">(</span><span class="n">sleep_ms</span><span class="p">)</span>

        <span class="n">ind</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">ind</span><span class="o">*</span><span class="n">sleep_ms</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">child</span><span class="p">((</span><span class="s1">&#39;timeout&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">():</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">emit_status</span><span class="p">(</span><span class="n">ThreadCommand</span><span class="p">(</span><span class="s1">&#39;raise_timeout&#39;</span><span class="p">))</span>
            <span class="k">break</span>

        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emit_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="asynchronous-example">
<h3>Asynchronous example:<a class="headerlink" href="#asynchronous-example" title="Permalink to this headline">¶</a></h3>
<p>The code below is derived from <em>daq_Andor_SDK2</em> (in <em>andor</em> hardware folder) and shows how to create a thread waiting for data ready and triggering the emission of data</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DAQ_AndorSDK2</span><span class="p">(</span><span class="n">DAQ_Viewer_base</span><span class="p">):</span>

    <span class="n">callback_signal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span> <span class="c1">#used to talk with the callback object</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">ini_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="n">AndorCallback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">WaitForAcquisition</span><span class="p">)</span> <span class="c1"># the callback is linked to the controller WaitForAcquisition method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_thread</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">()</span> <span class="c1">#creation of a Qt5 thread</span>
        <span class="n">callback</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_thread</span><span class="p">)</span> <span class="c1">#callback object will live within this thread</span>
        <span class="n">callback</span><span class="o">.</span><span class="n">data_sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_data</span><span class="p">)</span>  <span class="c1"># when the wait for acquisition returns (with data taken), emit_data will be fired</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callback_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="o">.</span><span class="n">wait_for_acquisition</span><span class="p">)</span> <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_thread</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">grab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Naverage</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1">#trigger the wait_for_acquisition method</span>

<span class="k">def</span> <span class="nf">emit_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function used to emit data obtained by callback.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_grabed_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Camera&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">sizey</span><span class="p">,</span> <span class="n">sizex</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))],</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)])</span>


<span class="k">class</span> <span class="nc">AndorCallback</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>

    <span class="n">data_sig</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wait_fn</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AndorCallback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_fn</span> <span class="o">=</span> <span class="n">wait_fn</span>

    <span class="k">def</span> <span class="nf">wait_for_acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_fn</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="s1">&#39;DRV_NO_NEW_DATA&#39;</span><span class="p">:</span> <span class="c1">#will be returned if the main thread called CancelWait</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_sig</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</pre></div>
</div>
<p>Documentation from Andor SDK concerning the WaitForAcquisition method of the dll:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><em>unsigned int WINAPI WaitForAcquisition(void)</em></div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">WaitForAcquisition</span></code> can be called after an acquisition is started using StartAcquisition to put the calling thread to sleep until an Acquisition Event occurs.</div>
<div class="line">It will use less processor resources than continuously polling with the GetStatus function. If you wish to restart the calling thread without waiting for an Acquisition event, call the function CancelWait.</div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="hardware-averaging">
<span id="id7"></span><h2>Hardware averaging:<a class="headerlink" href="#hardware-averaging" title="Permalink to this headline">¶</a></h2>
<p>By default, if averaging of data is needed the Viewer module will take care of it software wise. However, if the hardware
controller provides an efficient method to do it (that will save time) then you should set the class field
<code class="docutils literal notranslate"><span class="pre">hardware_averaging</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DAQ_NDViewer_Template</span><span class="p">(</span><span class="n">DAQ_Viewer_base</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> Template to be used in order to write your own viewer modules</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">hardware_averaging</span> <span class="o">=</span> <span class="bp">True</span> <span class="c1">#will use the accumulate acquisition mode if averaging</span>
    <span class="c1">#is True else averaging is done software wise</span>
</pre></div>
</div>
</div>
<div class="section" id="hardware-needed-files">
<h2>Hardware needed files<a class="headerlink" href="#hardware-needed-files" title="Permalink to this headline">¶</a></h2>
<p>If you are using/referring to custom python wrappers/dlls… within your plugin and need a place where to copy them
in PyMoDAQ, then use the <code class="docutils literal notranslate"><span class="pre">\pymodaq_plugins\hardware</span></code> folder. For instance, the <code class="docutils literal notranslate"><span class="pre">daq_2Dviewer_AndorCCD</span></code> plugin need various files stored
in the <code class="docutils literal notranslate"><span class="pre">andor</span></code> folder (on github repository). I would therefore copy it as <code class="docutils literal notranslate"><span class="pre">\pymodaq_plugins\hardware\andor</span></code>
and call whatever module I need within (meaning there is a __init__.py file in the <em>andor</em> folder) as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#import controller wrapper</span>
<span class="kn">from</span> <span class="nn">pymodaq_plugins.hardware.andor</span> <span class="kn">import</span> <span class="n">daq_AndorSDK2</span> <span class="c1">#this import the module DAQ_AndorSDK2 containing classes, methods...</span>
<span class="c1">#and then use it as you see fit in your module</span>
</pre></div>
</div>
</div>
<div class="section" id="specific-tcp-ip-plugin">
<h2>Specific TCP/IP plugin<a class="headerlink" href="#specific-tcp-ip-plugin" title="Permalink to this headline">¶</a></h2>
<p>It is possible to use a TCP/IP plugin in order to communicate with a distant client. For instance, the module
<code class="docutils literal notranslate"><span class="pre">daq_2Dviewer_TCP_GRABBER</span></code> is one such example. It inherits from the base <code class="docutils literal notranslate"><span class="pre">DAQ_TCP_Server</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymodaq.daq_viewer.utility_classes</span> <span class="kn">import</span> <span class="n">DAQ_TCP_server</span>
</pre></div>
</div>
<p>This plugin is still experimental and focused on one particular relation with a client. Please open an issue on github
if you have specific need and/or propositions.</p>
</div>
<div class="section" id="how-to-contribute">
<h2>How to contribute?<a class="headerlink" href="#how-to-contribute" title="Permalink to this headline">¶</a></h2>
<p>If you wish to develop a plugin specific to a new hardware not present on the github repo (and I strongly encourage you
to do so!!), you will have to follow the rules as
stated above. However, the best practice would be to <em>fork</em> pymodaq_plugins repository. On windows, you can use
<a class="reference external" href="https://desktop.github.com/">Github Desktop</a>. Then you can manually install the forked package (typically using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">-e</span> <span class="pre">install</span> <span class="pre">.</span></code> from
winpython command line where you <em>cd</em> within the forked package. This command will kind of install the package but
any change you apply on the local folderwill be applied on the package. Once you’re ready with a working plugin, you can then
<em>push</em> your branch that will be merged with the main branch after validation.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Utility_Modules.html" class="btn btn-neutral float-right" title="Utility Modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../saving.html" class="btn btn-neutral" title="Saving datas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Weber Sébastien

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>